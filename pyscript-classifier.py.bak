from utils import log, get_element_by_id, get_file_selector_files_by_element_id
import json
import js
import requests

API_CLASSIFIER_URL = 'https://hf.space/embed/jph00/testing/+/api/predict/'

file_selector = get_element_by_id('fileUploader')
file_selector_files = get_file_selector_files_by_element_id('fileUploader')
files = []

print('Hello world!')

def handleFiles(files):
    js.console.log('handleFiles python function called.')

def test_on_startup():
    js.console.log('python startup function called...')
    print('test on startup print statement called...')

async def click_handle(*args,**kwargs):
    js.console.log('Button Clicked... *args, **kwargs')
    await get_file_selector_files_by_element_id('fileUploader',process_file)
    js.console.log('get_file_selector_files_by_element_id has run...')
    # js.console.log('FS: '+str(file_selector.files.length))
    # print(file_selector.files.length)
    # print(len(file_selector.files))
    # print(file_selector.files)
    # print(*args)
    # print(**kwargs)
    # js.console.log(json.dumps(args))
    # js.console.log(json.dumps(kwargs))

async def process_file(file):
    log('called: process_file')
    files.append(file)
    data = json.dumps({'data':[file]})
    # log(data)
    # data = json.dumps({'a':'b'})
    # post = {'method':'POST','body':data,'headers': { "Content-Type": "application/json" ,"Access-Control-Allow-Origin":"*"}}
    post = {'method':'POST','body':data,'headers': { "Content-Type": "application/json"}}
    # data = JSON.stringify({"data":[ reader.result ]})
    #     post = { method: "POST", body: data, headers: { "Content-Type": "application/json" } }
    #     fetch(url, post)
    response = await pyfetch(API_CLASSIFIER_URL,**post)
    log(await response.json())
test_on_startup()
# pyfetch('https://google.com',headers={"Access-Control-Allow-Origin":"*"})
# pyfetch(url=API_CLASSIFIER_URL, method="POST", body='asdf', headers={ "Content-Type": "application/json" } )